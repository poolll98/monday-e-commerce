stages: # List of stages for jobs, and their order of execution
  - build
  #  - docker-build
  - test
#  - deploy

variables:
  DOCKER_HOST: tcp://docker:2375/

build-job: # This job runs in the build stage, which runs first.
  stage: build
  image: maven:3.8.3-openjdk-17
  script:
    - cd Backend/EcommerceBackend
    - echo "Building the backend jar"
    - mvn clean package -DskipTests
    - echo "Build complete."
  artifacts:
    paths:
      - Backend/EcommerceBackend/target/*.jar
  only:
    refs:
      - develop
      - master

npm-build-job:
  stage: build
  image: node:latest
  script:
    - npm config set registry ${CI_NPM_REGISTRY}
    - npm install
  cache:
    paths:
      - node_modules/
  artifacts:
    expire_in: 1 days
    when: on_success
    paths:
      - node_modules/

npm-test:
  stage: test
  dependencies:
    - npm-build-job
  script:
    - npm test
#docker-build:
#  image: docker:23.0.3
#  stage: build
#  services:
#    - docker:dind
#  script:
#    - cd Backend/EcommerceBackend
#    - echo "Building the backend image"
#    - docker build -t monday-backend .
#  dependencies:
#    - build-job
