# E-commerce Backend
The application is based on Spring Boot framework, supporting Token based Authentication with JWT and Spring Security.
It uses Spring Data JPA to interact with PostgreSQL Database.

## Use the backend application with Docker
1. Run "mvn package" to create the Backend application as a jar. Alternatively, run "./mvnw clean package -DskipTests" if you want to create the jar without having the DB already running.

2. Make sure the Dockerfile contains the exact name of the generated jar and then run:
docker build -t monday-backend .

3. Your postgres image should already be present on your environment. The image, not the container. Actually the postgres container you were previously using should be stopped now. Once you checked all this and saw your backend image was created at step 2, run: docker compose up -d

4. Have fun (See Interact with the Services section) and when done, you may as well stop the containers, if you like: docker compose down




## Use the backend application without Docker
### Run the Database
The first time you execute the procedure:
```
docker load < mon-pg.tar docker run --name mon-pg -p 5432:5432 -e POSTGRES_PASSWORD=xyz -d postgres docker start mon-pg
```
Otherwise, just make sure that the container "mon-ecom-pg" is active, since it contains the PostgreSQL Server.
Instead, the e-commerce schema is automatically generated by the application thanks to Hibernate.

### Set the following environment variable with the POSTGRES_PASSWORD:
```
export POSTGRES_DB_PASSWORD= POSTGRES_PASSWORD
```

### Run the Spring Boot application
```
./mvnw spring-boot:run
```

### Run the following SQL insert statements 
The first time you run the application, insert these data into the Database by hand (since we don't have any kind of APIs for this of operation yet):
```
INSERT INTO roles(name) VALUES('ROLE_USER');
INSERT INTO roles(name) VALUES('ROLE_ADMIN');

INSERT INTO shopping_cart(login_user_id) VALUES(1);
INSERT INTO product_category(category_name) VALUES('food');
INSERT INTO product(description,instock,name,price,product_category_id) VALUES('super random pizza', true,'pizza', 8,1);
```


## Interact with the services
The application automatically generates the documentation about the available endpoints, thanks to Swagger, here:
```
http://localhost:8080/swagger-ui/index.html
```
### Postman
Use this tool to test the endpoints:

1)Test public resources:
```
 GET http://localhost:8080/api/test/all
```
2)Test user resources:
``` 
- Create an account:

POST http://localhost:8080/api/auth/signup

body: {  
    
    "username": "test123",
    "email": "test123@gmail.com",
    "password": "testpassw",
    "phone": "3456787981",
    "firstname": "test_name",
    "lastname": "test_surname",
    "isbuyer": true,
    "isseller": true,
    "role": ["user"]
}   


- Login with the credentials:

POST http://localhost:8080/api/auth/signin

body: {  
"username": "test123",
"password": "testpassw"
}

Take note of the generated bear token.


- Test the token: 

GET http://localhost:8080/api/test/user

Authorization: type: Bear Token


- Add a product to the shopping cart:

POST http://localhost:8080/shopcart/add

body:{
    "quantity": 5,
    "cartid": 1,
    "prodid": 1
}

Authorization: type: Bear Token


- Edit the quantity of a product in the shopping cart:

PUT http://localhost:8080/shopcart/editq

body:
{
    "cartItemId": 1,
    "quantity": 8
}

Authorization: type: Bear Token

- Delete a product from the shopping cart:

DELETE http://localhost:8080/shopcart/remove/1

Authorization: type: Bear Token
``` 
